# Roadmap

## Core CLI

The foundation CLI structure with core commands.

### Commands

- [x] `storm version` - Print version information
- [x] `storm generate` - Generate changelog entries from Git commits
    - [x] Parse commit range (from/to refs)
    - [x] Support `--since` flag
    - [x] Support `--interactive` flag for TUI selection
    - [x] Parse conventional commits
    - [x] Write entries to `.changes/`
    - [ ] Deduplication logic (see TODO in generate.go)
- [x] `storm unreleased` - Manage unreleased changes
    - [x] `unreleased add` - Create new entry
    - [x] `unreleased list` - Display entries (text and JSON)
    - [x] `unreleased review` - Interactive TUI review
    - [ ] Implement delete action from review
    - [ ] Implement edit action from review
- [x] `storm release` - Promote unreleased changes to CHANGELOG
    - [x] Read all `.changes/*.md` files
    - [x] Merge into `CHANGELOG.md`
    - [x] Create version header with date
    - [x] Clear `.changes/` directory with `--clear-changes` flag
    - [x] Optional date override with `--date` flag
    - [x] Generate GitHub comparison links automatically
    - [x] Dry-run mode
    - [ ] Optional Git tag creation (Phase 7)
- [x] `storm diff`: display inline diffs between refs with support for file filtering,
  context expansion, and multiple view modes.

## Git Integration and Commit Parsing

- [x] Core gitlog utilities for parsing refs, retrieving commits and file contents, and
  categorizing conventional commits by type and change significance.

## Diff Engine and Styling

- [x] Diff package implements the Myers diff algorithm with split and unified rendering,
  compressed unchanged sections, and an iceberg-themed color palette for styled visual
  output.

## `.changes` Storage and Parsing

Local storage for unreleased changelog entries.

### Tasks

- [x] Define `Entry` struct with YAML frontmatter
- [x] Implement `changeset.Write(dir, entry)`
    - [x] Generate unique filenames (timestamp-based)
    - [x] Write YAML frontmatter
    - [x] Create `.changes/` directory if missing
- [x] Implement `changeset.List(dir)`
    - [x] Parse YAML frontmatter
    - [x] Return `EntryWithFile` structs
- [ ] Implement diff-based deduplication
    - [ ] Compute diff hash for commits
    - [ ] Load existing entries by hash
    - [ ] Detect rebased commits (same diff, different hash)
    - [ ] Add `--update-rebased`, `--skip-rebased`, `--warn-rebased` flags

## TUI

- [x] Delivered Bubble Tea UIs for selecting commits, reviewing unreleased changes, and
  interactively viewing multi-file diffs with full keyboard-driven navigation and view
  toggles.

## Keep a Changelog Writer

- [x] Adds a full changelog pipeline that parses the existing file, builds and writes
new releases, and validates dates/sections to strictly match the Keep a Changelog
[spec](https://keepachangelog.com/en/1.1.0/), including autogenerated comparison links.

## Phase 7: Git Tagging and CI Integration

Repository tagging and automation-friendly features.

### Tasks

- [ ] Implement Git tagging in `release` command
    - [ ] Create annotated tag with version
    - [ ] Include release notes in tag message
    - [ ] Validate tag doesn't already exist
    - [ ] Support `--tag` flag
- [ ] Add JSON output modes for all commands
    - [x] `unreleased list --json` (implemented)
    - [ ] `generate --output-json`
    - [ ] `release --output-json`
- [x] Add `--dry-run` support
    - [x] `release --dry-run` - implemented
    - [x] Show what would be written without writing
    - [x] Display preview of CHANGELOG changes with styled output
- [ ] Non-TTY environment handling
    - [ ] Detect TTY availability
    - [ ] Fallback to non-interactive mode
    - [ ] CI-friendly error messages
- [ ] Add pre-commit hook examples
    - [ ] Validate commit message format
    - [ ] Ensure `.changes/` entries exist for features
- [ ] Create GitHub Actions workflow examples
    - [ ] Auto-release on version tag
    - [ ] Validate CHANGELOG on PR

## Testing Strategy

### Current Status

- [x] Test utilities package - internal/testutils/
- [x] Unit tests for changelog package - internal/changelog/changelog_test.go
- [ ] Unit tests for diff engine
- [ ] Unit tests for Git integration (in-memory repos)
- [ ] Golden files for diff output
- [ ] Golden files for changelog output
- [ ] Bubble Tea program testing

### Planned Test Coverage

- [ ] `internal/diff` - Myers algorithm correctness
- [ ] `internal/gitlog` - Commit parsing and range queries
- [x] `internal/changeset` - File I/O and YAML parsing
- [x] `internal/changelog` - Keep a Changelog formatting (13 test cases, all passing)
- [ ] `cmd/generate` - End-to-end commit to entry flow
- [ ] `cmd/unreleased` - Entry management
- [ ] `cmd/release` - Changelog generation and tagging

## Notes

- No shell calls to `git` - all operations via `go-git`
- Conventional commits are parsed but not enforced
- TUI sessions degrade gracefully in non-TTY environments (to be implemented)
- All output follows Keep a Changelog v1.1.0 specification
